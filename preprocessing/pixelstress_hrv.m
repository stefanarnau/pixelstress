clear all;

% PATH VARS
PATH_EEGLAB = '/home/plkn/eeglab2025.0.0/';
PATH_RAW = '/mnt/data_dump/pixelstress/0_eeg_raw/';

subject_list = {'9_1',...
                '10_1',...
                '14_1',...
                '17_1',...
                '19_1',...
                '21_1',...
                '23_1',...
                '25_1',...
                '26_1',...
                '28_1',...
                '30_1',...
                '32_1',...
                '35_1',...
                '36_1',...
                '38_1',...
                '40_1',...
                '43_1',...
                '44_1',...
                '47_1',...
                '48_1',...
                '50_1',...
                '52_1',...
                '55_1',...
                '57_1',...
                '58_1',...
                '76_1',...
                '77_1',...
                '79_1',...
                '81_1',...
                '82_1',...
                '84_1',...
                '85_1',...
                '86_1',...
                '87_1',...
                '88_1',...
                '89_1',...
                '90_1',...
                '91_1',...
                '92_1',...
                '7_2',...
                '8_2',...
                '11_2',...
                '12_2',...
                '15_2',...
                '16_2',...
                '20_2',...
                '22_2',...
                '24_2',...
                '27_2',...
                '29_2',...
                '31_2',...
                '33_2',...
                '34_2',...
                '37_2',...
                '39_2',...
                '41_2',...
                '42_2',...
                '45_2',...
                '46_2',...
                '51_2',...
                '53_2',...
                '54_2',...
                '56_2',...
                '59_2',...
                '60_2',...
                '78_2',...
                '80_2',...
                '93_2',...
                '94_2',...
                '95_2',...
                '96_2',...
                '97_2',...
                '98_2'
               };

% Failed:
% '18_2' something with ICA
% '49_2' trialcounts off
% '13_1' trialcount too low. Notes: Abbruch wegen Kreislaufproblemen.

% Init eeglab
addpath(PATH_EEGLAB);
eeglab;

% Loop subjects
for s = 1 : length(subject_list)

    % Load EEG
    fn = ['ExpExp104_', subject_list{s}, '_1.vhdr'];
    EEG = pop_loadbv(PATH_RAW, fn, [], []);

    % Set session string
    if str2num(subject_list{s}(end)) == 1
        str_cond = 'exp';
    elseif str2num(subject_list{s}(end)) == 2
        str_cond = 'cntr';
    end

    % Get id
    subject_id = str2num(subject_list{s}(1 : end - 2));

    % Iterate events
    trialinfo = [];
    block_nr = -1;
    trial_nr_total = 0;
    enums = zeros(256, 1);
    for e = 1 : length(EEG.event)

        % If an S event
        if strcmpi(EEG.event(e).type(1), 'S')

            % Get event number
            enum = str2num(EEG.event(e).type(2 : end));

            enums(enum) = enums(enum) + 1;

            % Set block number
            if enum >= 210 & enum <= 220
                block_nr = str2num(EEG.event(e).type(end));
            end

            % If trial and no practice block
            if strcmpi(EEG.event(e).type, 'A  1') & block_nr > 0

                % Save info
                trial_nr_total = trial_nr_total + 1;
                trialinfo(trial_nr_total, :) = [trial_nr_total,...
                                                block_nr,...
                                                EEG.event(e).latency,...
                                                ];

            end
        end
    end

    % Trigger recording stopped in block 7 for subject 49_2 after trial 672
    if ~strcmpi(subject_list{s}, '49_2')

        % Check trialcount
        if trial_nr_total ~= 768
            fprintf('\n\n\nSOMETHING IS WEIIIRDDD with the trials!!!!!!\n\n\n');
            pause;
        end
    end

end % End subject loop


